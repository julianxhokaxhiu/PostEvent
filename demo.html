<!DOCTYPE html>
<html>
<head>
  <title>PostEvent Demo</title>
</head>
<body>
  <!-- Load the PostEvent library -->
  <script src="/dist/PostEvent.js"></script>
  <!--
    On Window load, initialize the PostEvent library and try some demos:

    1) Make sure the main thread tunes on "say" and alerts a custom parameter
    2) Make sure the main thread tunes on "only.you" and alerts if successfull. This test is for namespaces.
    3) Embed the iFrames and send an "iframeInit" event, which should be listened from the iFrames. If successful they should greet with their ID.
    4) The first iFrame will be able to trigger the "only.you" event. An alert will be sent by the main thread and test2 iframe.
  -->
  <script>
    window.onload = function () {
      var postEvent = new PostEvent(),
          appendIFrame = function ( id ) {
            var iframe = document.createElement('iframe');
            iframe.id = id;
            iframe.src = 'about:blank';
            document.body.appendChild(iframe);

            if(iframe.contentDocument) doc = iframe.contentDocument;
            else if(iframe.contentWindow) doc = iframe.contentWindow.document;
            else if(iframe.document) doc = iframe.document;

            if(doc == null) throw "Document not initialized";

            doc.open();
            doc.write(document.getElementById( iframe.id + '-tpl' ).innerHTML);
            doc.close();
          }

      postEvent
      .on( 'say', function ( params ){
        alert( params.message );
      })
      .on( 'only.you', function (){
        alert( '[main] ' + 'Were you calling me?')
      })
      .trigger( 'say', { message: 'Hello World' });

      appendIFrame( 'test' );
      appendIFrame( 'test2' );

      setTimeout( function () {
        postEvent.trigger( 'iframeInit' );
      }, 10000 );
    }
  </script>
  <!-- HTML template of test iframe -->
  <template id="test-tpl">
    <!DOCTYPE html>
      <html>
        <head>
        </head>
        <body>
          <script src="/dist/PostEvent.js"></script>
          <script>
            window.onload = function () {
              var postEvent = new PostEvent();

              postEvent
              .trigger( 'only.you' )
              .on( 'iframeInit', function () {
                alert( 'Hello, this is ' + window.frameElement.id);
              })
            }
          </script>
        </body>
      </html>
  </template>
  <!-- HTML template of test2 iframe -->
  <template id="test2-tpl">
    <!DOCTYPE html>
      <html>
        <head>
        </head>
        <body>
          <script src="/dist/PostEvent.js"></script>
          <script>
            window.onload = function () {
              var postEvent = new PostEvent();

              postEvent
              .on( 'only.you', function () {
                alert( '[' + window.frameElement.id + '] ' + 'Were you calling me?')
              })
              .on( 'iframeInit', function () {
                alert( 'Hello, this is ' + window.frameElement.id);
              })
            }
          </script>
        </body>
      </html>
  </template>
</body>
</html>